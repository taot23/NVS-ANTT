ervidorvoipnvs@app-licenca:/opt/vendas-app/nvs-antt2$ # Verificar os logs da aplicação para ver o erro exato
pm2 logs vendas-app-prod --lines 20

# Se não existir, verificar com o nome atual
pm2 logs vendas-app --lines 20
[TAILING] Tailing last 20 lines for [vendas-app-prod] process (change the value with --lines option)
/home/servidorvoipnvs/.pm2/logs/vendas-app-prod-out.log last 20 lines:
21|vendas- | 1:51:14 AM [websocket] WebSocket configurado no caminho /ws
21|vendas- | 1:51:14 AM [express] serving on port 5001
21|vendas- | 1:51:16 AM [express] GET /api/user 401 in 8ms
21|vendas- | 1:51:18 AM [express] GET /api/user 401 in 1ms
21|vendas- | Tentativa de login para usuário: admin 
21|vendas- | 1:51:24 AM [express] POST /api/login 500 in 50ms :: {"message":"password authentication failed for u…
21|vendas- | Tentativa de login para usuário: admin 
21|vendas- | 1:51:25 AM [express] POST /api/login 500 in 36ms :: {"message":"password authentication failed for u…
21|vendas- | Tentativa de login para usuário: admin 
21|vendas- | 1:51:34 AM [express] POST /api/login 500 in 20ms :: {"message":"password authentication failed for u…
21|vendas- | Tentativa de login para usuário: admin 
21|vendas- | 1:51:35 AM [express] POST /api/login 500 in 22ms :: {"message":"password authentication failed for u…
21|vendas- | Tentativa de login para usuário: admin 
21|vendas- | 1:51:40 AM [express] POST /api/login 500 in 20ms :: {"message":"password authentication failed for u…
21|vendas- | Tentativa de login para usuário: admin 
21|vendas- | 1:51:41 AM [express] POST /api/login 500 in 19ms :: {"message":"password authentication failed for u…
21|vendas- | Tentativa de login para usuário: admin 
21|vendas- | 1:51:45 AM [express] POST /api/login 500 in 16ms :: {"message":"password authentication failed for u…
21|vendas- | Tentativa de login para usuário: admin 
21|vendas- | 1:51:46 AM [express] POST /api/login 500 in 18ms :: {"message":"password authentication failed for u…

/home/servidorvoipnvs/.pm2/logs/vendas-app-prod-error.log last 20 lines:
21|vendas- |   hint: undefined,
21|vendas- |   position: undefined,
21|vendas- |   internalPosition: undefined,
21|vendas- |   internalQuery: undefined,
21|vendas- |   where: undefined,
21|vendas- |   schema: undefined,
21|vendas- |   table: undefined,
21|vendas- |   column: undefined,
21|vendas- |   dataType: undefined,
21|vendas- |   constraint: undefined,
21|vendas- |   file: 'auth.c',
21|vendas- |   line: '326',
21|vendas- |   routine: 'auth_failed'
21|vendas- | }
21|vendas- | error: password authentication failed for user "nvsantt"
21|vendas- |     at /opt/vendas-app/nvs-antt2/node_modules/pg-pool/index.js:45:11
21|vendas- |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
21|vendas- |     at async file:///opt/vendas-app/nvs-antt2/node_modules/drizzle-orm/node-postgres/session.js:83:22
21|vendas- |     at async DatabaseStorage.getUserByUsername (file:///opt/vendas-app/nvs-antt2/dist/index.js:528:20)
21|vendas- |     at async Strategy._verify (file:///opt/vendas-app/nvs-antt2/dist/index.js:3013:22)

^C
[TAILING] Tailing last 20 lines for [vendas-app] process (change the value with --lines option)
/home/servidorvoipnvs/.pm2/logs/vendas-app-error.log last 20 lines:
20|vendas- | 1:03:35 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=t6lUGxYEAzm-auSk6hbzE (resolved id: /src/main.tsx?v=t6lUGxYEAzm-auSk6hbzE). Does the file exist?
20|vendas- | 1:20:19 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=a64rhbn7PaVlGBvkcxPUA (resolved id: /src/main.tsx?v=a64rhbn7PaVlGBvkcxPUA). Does the file exist?
20|vendas- | 1:24:21 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=KlxtHXsryzjVGt_vcgsjX (resolved id: /src/main.tsx?v=KlxtHXsryzjVGt_vcgsjX). Does the file exist?
20|vendas- | 1:28:02 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=a-FMKiyDNpei5DbWEnLw5 (resolved id: /src/main.tsx?v=a-FMKiyDNpei5DbWEnLw5). Does the file exist?
20|vendas- | 1:28:10 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=xYTK2TdZLfwzqD3WLN7sp (resolved id: /src/main.tsx?v=xYTK2TdZLfwzqD3WLN7sp). Does the file exist?
20|vendas- | 1:28:20 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=3JR2vRqhx6cLgx8u4oot3 (resolved id: /src/main.tsx?v=3JR2vRqhx6cLgx8u4oot3). Does the file exist?
20|vendas- | 1:31:40 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=6FJTGv59Amrp_Jpost6U3 (resolved id: /src/main.tsx?v=6FJTGv59Amrp_Jpost6U3). Does the file exist?
20|vendas- | 1:32:54 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=-EJnH9vNhbUpxujfnr6or (resolved id: /src/main.tsx?v=-EJnH9vNhbUpxujfnr6or). Does the file exist?
20|vendas- | 1:33:04 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=EBC565SYPcg0iESaH-Sp- (resolved id: /src/main.tsx?v=EBC565SYPcg0iESaH-Sp-). Does the file exist?
20|vendas- | 1:33:06 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=u54oBfXLzmeSWodc_Ra1_ (resolved id: /src/main.tsx?v=u54oBfXLzmeSWodc_Ra1_). Does the file exist?
20|vendas- | 1:33:09 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=xybkr3CkcwBhKE5X2mN16 (resolved id: /src/main.tsx?v=xybkr3CkcwBhKE5X2mN16). Does the file exist?
20|vendas- | 1:33:12 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=736DaX3qistqOQL-v-ejA (resolved id: /src/main.tsx?v=736DaX3qistqOQL-v-ejA). Does the file exist?
20|vendas- | 1:34:35 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=IDdaV6OR-cloGlTwtE6d7 (resolved id: /src/main.tsx?v=IDdaV6OR-cloGlTwtE6d7). Does the file exist?
20|vendas- | 1:35:13 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=FNvKMiZfmPhJPCzgDKHX0 (resolved id: /src/main.tsx?v=FNvKMiZfmPhJPCzgDKHX0). Does the file exist?
20|vendas- | 1:35:15 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=ozl3V0eEUWMbCUQxtPozk (resolved id: /src/main.tsx?v=ozl3V0eEUWMbCUQxtPozk). Does the file exist?
20|vendas- | 1:35:17 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=3ZH7EDbHT8-cLPDFbUD0Q (resolved id: /src/main.tsx?v=3ZH7EDbHT8-cLPDFbUD0Q). Does the file exist?
20|vendas- | 1:36:05 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=zyUyP9JKiezP3PHIVWyJT (resolved id: /src/main.tsx?v=zyUyP9JKiezP3PHIVWyJT). Does the file exist?
20|vendas- | 1:36:41 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=Gt890aydiQjXl6dvGtxMJ (resolved id: /src/main.tsx?v=Gt890aydiQjXl6dvGtxMJ). Does the file exist?
20|vendas- | 1:36:46 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=6CatpDm6LV6nvgCXUMwIr (resolved id: /src/main.tsx?v=6CatpDm6LV6nvgCXUMwIr). Does the file exist?
20|vendas- | 1:37:30 AM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=z85Zdw04fYB6BEXsxa1xh (resolved id: /src/main.tsx?v=z85Zdw04fYB6BEXsxa1xh). Does the file exist?

/home/servidorvoipnvs/.pm2/logs/vendas-app-out.log last 20 lines:
20|vendas- | 1:34:37 AM [websocket] WebSocket configurado no caminho /ws
20|vendas- | 1:34:37 AM [express] serving on port 5001
20|vendas- | 1:34:53 AM [websocket] WebSocket configurado no caminho /ws
20|vendas- | 1:34:53 AM [express] serving on port 5001
20|vendas- | 1:35:14 AM [websocket] WebSocket configurado no caminho /ws
20|vendas- | 1:35:14 AM [express] serving on port 5001
20|vendas- | 1:35:16 AM [websocket] WebSocket configurado no caminho /ws
20|vendas- | 1:35:16 AM [express] serving on port 5001
20|vendas- | 1:35:18 AM [websocket] WebSocket configurado no caminho /ws
20|vendas- | 1:35:18 AM [express] serving on port 5001
20|vendas- | 1:35:50 AM [websocket] WebSocket configurado no caminho /ws
20|vendas- | 1:35:50 AM [express] serving on port 5001
20|vendas- | 1:36:06 AM [websocket] WebSocket configurado no caminho /ws
20|vendas- | 1:36:06 AM [express] serving on port 5001
20|vendas- | 1:36:42 AM [websocket] WebSocket configurado no caminho /ws
20|vendas- | 1:36:42 AM [express] serving on port 5001
20|vendas- | 1:36:47 AM [websocket] WebSocket configurado no caminho /ws
20|vendas- | 1:36:47 AM [express] serving on port 5001
20|vendas- | 1:37:31 AM [websocket] WebSocket configurado no caminho /ws
20|vendas- | 1:37:31 AM [express] serving on port 5001

^C
servidorvoipnvs@app-licenca:/opt/vendas-app/nvs-antt2$ # Verificar as variáveis de ambiente
cat .env

# Atualizar com a URL correta se necessário
cat > .env << 'EOL'
NODE_ENV=production
PORT=5001
DATABASE_URL=postgresql://nvsantt:nvs123@localhost:5432/vendas_db
SESSION_SECRET=NvsAntt2025thiago
EOL

# Reiniciar a aplicação
pm2 restart vendas-app
NODE_ENV=production
PORT=5001
DATABASE_URL=postgresql://nvsantt:nvs123@localhost:5432/vendas_db
SESSION_SECRET=NvsAntt2025thiago
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [vendas-app](ids: [ 20 ])
[PM2] [vendas-app](20) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 16 │ aet-license-system │ cluster  │ 23   │ online    │ 0%       │ 106.6mb  │
│ 20 │ vendas-app         │ fork     │ 4    │ online    │ 0%       │ 19.0mb   │
│ 21 │ vendas-app-prod    │ fork     │ 1    │ online    │ 0%       │ 95.4mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
Module
┌────┬────────────────────┬──────────┬──────────┬──────────┐
│ id │ name               │ status   │ cpu      │ mem      │
├────┼────────────────────┼──────────┼──────────┼──────────┤
│ 0  │ pm2-logrotate      │ online   │ 0%       │ 45.6mb   │
└────┴────────────────────┴──────────┴──────────┴──────────┘
servidorvoipnvs@app-licenca:/opt/vendas-app/nvs-antt2$ 